#!/bin/sh

(
  echo "Waiting for gateway_id in logs..." >> /tmp/gateway_id.log
  for i in $(seq 1 30); do
    logread | grep -i "gateway id" | grep -oE '[0-9a-f]\{16\}' | tail -n1 > /tmp/gateway_id
    if [ -s /tmp/gateway_id ]; then
      echo "gateway_id found: $(cat /tmp/gateway_id)" >> /tmp/gateway_id.log
      break
    fi
    sleep 10
  done
) &
